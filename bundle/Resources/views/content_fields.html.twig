
{% use 'EzPublishCoreBundle::content_fields.html.twig' %}

{% trans_default_domain 'enhancedrelationllist_attribute' %}

{% block intprogenhancedrelationlist_field %}
    {% import _self as erl_table_macros %}
    {% if field.value.relations is not empty %}
        {% include '@ezdesign/parts/table_header.html.twig' with {headerText: 'field.group.ungrouped'|trans} %}
        <table class="table{% if field.value.groups is empty %} mb-0{% endif %}">
            {{ erl_table_macros.table_head_macro(fieldSettings, field) }}
            <tbody>
            {% for relation in field.value.relations %}
                {{ erl_table_macros.relation_row(relation, fieldSettings) }}
            {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% for name,group in field.value.groups %}
        {% include '@ezdesign/parts/table_header.html.twig' with {headerText: name} %}
        <table class="table{% if loop.last %} mb-0{% endif %}">
            {{ erl_table_macros.table_head_macro(fieldSettings, field) }}
            <tbody>
            {% for relation in group.relations %}
                {{ erl_table_macros.relation_row(relation, fieldSettings) }}
            {% endfor %}
            </tbody>
        </table>
    {% endfor %}
{% endblock %}

{% macro table_head_macro(fieldSettings, field) %}
    <thead>
    <tr>
        <th>{{ 'field_definition.attribute.table.head.relation'|trans }}</th>
        {% for attributeDefinition in fieldSettings.attributeDefinitions %}
            <th>
                {% if attributeDefinition.name[field.languageCode] is defined %}
                    {{ attributeDefinition.name[field.languageCode] }}
                {% else %}
                    {{ attributeDefinition.name|first }}
                {% endif %}
            </th>
        {% endfor %}
    </tr>
    </thead>
{% endmacro %}

{% macro relation_row(relation, fieldSettings) %}
    <tr>
        <td>
            {{ render(controller('ez_content:viewAction', {'contentId': relation.contentId, 'viewType': 'element_simple_link', 'layout': false})) }}
        </td>
        {% for identifier,definition in fieldSettings.attributeDefinitions %}
            <td>
                {{ erl_render_attribute(relation.attributes[identifier], definition) }}
            </td>
        {% endfor %}
    </tr>
{% endmacro %}